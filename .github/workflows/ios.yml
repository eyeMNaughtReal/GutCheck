name: iOS Build & Test
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  build:
    runs-on: macos-14  # For Xcode 16+

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Set up Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable


    - name: List available simulators
      run: xcrun simctl list devices

    - name: Build GutCheck
      working-directory: GutCheck
      run: |
        xcodebuild clean build \
          -project GutCheck.xcodeproj \
          -scheme GutCheck \
          -destination 'platform=iOS Simulator,OS=latest' \
          ONLY_ACTIVE_ARCH=NO

    - name: Run Unit Tests
      working-directory: GutCheck
      run: |
        xcodebuild test \
          -project GutCheck.xcodeproj \
          -scheme GutCheck \
          -destination 'platform=iOS Simulator,OS=latest' \
          ONLY_ACTIVE_ARCH=NO
